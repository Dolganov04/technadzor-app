<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–ù: –ü—Ä–µ–¥–ø–∏—Å–∞–Ω–∏–µ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #000000;
            --secondary-bg: #f5f5f5;
            --hint-color: #888888;
            --btn-color: #2481cc;
            --btn-text: #ffffff;
        }

        body.dark-mode {
            --bg-color: #1e1e1e;
            --text-color: #ffffff;
            --secondary-bg: #2c2c2c;
            --hint-color: #aaaaaa;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--tg-theme-bg-color, var(--bg-color));
            color: var(--tg-theme-text-color, var(--text-color));
            padding: 16px;
            margin: 0;
        }

        h2 { font-size: 20px; margin-bottom: 20px; }
        
        label {
            display: block;
            margin-top: 15px;
            margin-bottom: 5px;
            font-size: 14px;
            font-weight: 500;
            color: var(--tg-theme-hint-color, var(--hint-color));
        }

        select, input, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-sizing: border-box;
            background-color: var(--tg-theme-secondary-bg-color, var(--secondary-bg));
            color: var(--tg-theme-text-color, var(--text-color));
            font-size: 16px;
            -webkit-appearance: none;
        }

        .axis-group {
            display: flex;
            gap: 10px;
        }
        .axis-group select { width: 50%; }

        .hidden { display: none; }

        .photo-btn {
            margin-top: 20px;
            background-color: #ff9f0a;
            color: white;
            text-align: center;
            padding: 14px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            display: block;
        }

        .main-btn {
            margin-top: 30px;
            margin-bottom: 40px;
            width: 100%;
            padding: 16px;
            background-color: var(--tg-theme-button-color, var(--btn-color));
            color: var(--tg-theme-button-text-color, var(--btn-text));
            border: none;
            border-radius: 10px;
            font-size: 17px;
            font-weight: bold;
            cursor: pointer;
        }

        #photo-preview {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-top: 10px;
            display: none;
        }
    </style>
</head>
<body>

    <div id="step1">
        <h2>üèó –ì–¥–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ?</h2>
        
        <label>–°–æ–æ—Ä—É–∂–µ–Ω–∏–µ</label>
        <select id="building" onchange="updateAxes()">
            <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç</option>
            <option value="–ë–ª–æ–∫-—Å–µ–∫—Ü–∏—è 1">–ë–ª–æ–∫-—Å–µ–∫—Ü–∏—è 1</option>
            <option value="–ë–ª–æ–∫-—Å–µ–∫—Ü–∏—è 2">–ë–ª–æ–∫-—Å–µ–∫—Ü–∏—è 2</option>
            <option value="–ë–ª–æ–∫-—Å–µ–∫—Ü–∏—è 3">–ë–ª–æ–∫-—Å–µ–∫—Ü–∏—è 3</option>
            <option value="–ë–ª–æ–∫-—Å–µ–∫—Ü–∏—è 4">–ë–ª–æ–∫-—Å–µ–∫—Ü–∏—è 4</option>
            <option value="–ë–ª–æ–∫-—Å–µ–∫—Ü–∏—è 5">–ë–ª–æ–∫-—Å–µ–∫—Ü–∏—è 5</option>
            <option value="–ë–ª–æ–∫-—Å–µ–∫—Ü–∏—è 6">–ë–ª–æ–∫-—Å–µ–∫—Ü–∏—è 6</option>
            <option value="–ë–ª–æ–∫-—Å–µ–∫—Ü–∏—è 7">–ë–ª–æ–∫-—Å–µ–∫—Ü–∏—è 7</option>
            <option value="–ò–Ω—Ç–µ—Ä–Ω–∞—Ç">–ò–Ω—Ç–µ—Ä–Ω–∞—Ç</option>
            <option value="–¢—ë–ø–ª–∞—è —Å—Ç–æ—è–Ω–∫–∞">–¢—ë–ø–ª–∞—è —Å—Ç–æ—è–Ω–∫–∞</option>
        </select>

        <label>–≠—Ç–∞–∂</label>
        <select id="floor">
            <option value="1">1 —ç—Ç–∞–∂</option>
            <option value="2">2 —ç—Ç–∞–∂</option>
            <option value="3">3 —ç—Ç–∞–∂</option>
            <option value="4">4 —ç—Ç–∞–∂</option>
            <option value="–ö—Ä–æ–≤–ª—è">–ö—Ä–æ–≤–ª—è</option>
            <option value="–ü–æ–¥–≤–∞–ª">–ü–æ–¥–≤–∞–ª</option>
        </select>

        <label>–û—Å–∏ (–¶–∏—Ñ—Ä–æ–≤—ã–µ)</label>
        <div class="axis-group">
            <select id="axis_num_start"><option>-</option></select>
            <select id="axis_num_end"><option>-</option></select>
        </div>

        <label>–û—Å–∏ (–ë—É–∫–≤–µ–Ω–Ω—ã–µ)</label>
        <div class="axis-group">
            <select id="axis_let_start"><option>-</option></select>
            <select id="axis_let_end"><option>-</option></select>
        </div>

        <label>–ö–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</label>
        <select id="structure">
            <option value="–°—Ç–µ–Ω–∞">–°—Ç–µ–Ω–∞</option>
            <option value="–ö–æ–ª–æ–Ω–Ω–∞">–ö–æ–ª–æ–Ω–Ω–∞</option>
            <option value="–ë–∞–ª–∫–∞ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è">–ë–∞–ª–∫–∞ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è</option>
            <option value="–ü–ª–∏—Ç–∞ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è">–ü–ª–∏—Ç–∞ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è</option>
            <option value="–ü–∞—Ä–∞–ø–µ—Ç">–ü–∞—Ä–∞–ø–µ—Ç</option>
            <option value="–û–∫–æ–Ω–Ω—ã–π –ø—Ä–æ–µ–º">–û–∫–æ–Ω–Ω—ã–π –ø—Ä–æ–µ–º</option>
            <option value="–°—Ç—ã–∫ –∫–æ–ª–æ–Ω–Ω—ã –∏ –±–∞–ª–∫–∏">–°—Ç—ã–∫ –∫–æ–ª–æ–Ω–Ω—ã –∏ –±–∞–ª–∫–∏</option>
            <option value="–°—Ç—ã–∫ –ø–ª–∏—Ç—ã –∏ —Å—Ç–µ–Ω—ã">–°—Ç—ã–∫ –ø–ª–∏—Ç—ã –∏ —Å—Ç–µ–Ω—ã</option>
            <option value="–û–∫–æ–Ω–Ω–∞—è –ø–µ—Ä–µ–º—ã—á–∫–∞">–û–∫–æ–Ω–Ω–∞—è –ø–µ—Ä–µ–º—ã—á–∫–∞</option>
        </select>

        <label for="photo-input" class="photo-btn">üì∑ –°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ</label>
        <input type="file" id="photo-input" accept="image/*" capture="environment" style="display: none;">
        <img id="photo-preview" src="">

        <button class="main-btn" onclick="nextStep()">–î–∞–ª–µ–µ</button>
    </div>

    <div id="step2" class="hidden">
        <h2>üìù –î–µ—Ç–∞–ª–∏ –∏ –≤–∏–Ω–æ–≤–Ω–∏–∫</h2>

        <label>–ü–æ–¥—Ä—è–¥—á–∏–∫ (–ö–æ–º—É –≤—ã–¥–∞—Ç—å)</label>
        <select id="contractor" onchange="checkContractor()">
            <option value="–ü–†–û–ù–¢–û">–û–û–û ¬´–ü–†–û–ù–¢–û¬ª</option>
            <option value="–°—Ç—Ä–æ–π–ú–æ–Ω–æ–ª–∏—Ç">–û–û–û ¬´–°—Ç—Ä–æ–π–ú–æ–Ω–æ–ª–∏—Ç¬ª</option>
            <option value="–°—Ç—Ä–æ–π –¢—Ä–µ–π–¥">–û–û–û ¬´–°—Ç—Ä–æ–π –¢—Ä–µ–π–¥¬ª</option>
            <option value="other">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é...</option>
        </select>
        
        <input type="text" id="contractor_manual" class="hidden" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã">

        <label>–°—É—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏—è</label>
        <textarea id="issue" placeholder="–û–ø–∏—à–∏—Ç–µ –¥–µ—Ñ–µ–∫—Ç... (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º –∏ –¥–æ–ø–∏—Å–∞—Ç—å –≤ —á–∞—Ç–µ)"></textarea>

        <button class="main-btn" onclick="sendData()">üì§ –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å</button>
        <button class="main-btn" style="background-color: #ff3b30; margin-top: 0;" onclick="prevStep()">–ù–∞–∑–∞–¥</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Å–µ–π
        const AXES_DB = {
            "–ë–ª–æ–∫-—Å–µ–∫—Ü–∏—è 1": {
                num: ["2", "3", "4", "5"],
                let: ["–°", "–£", "–§", "–§/1", "–®", "–®/1", "–≠", "–≠/1", "–Æ", "–Ø", "–ë–ë"]
            },
            "–ë–ª–æ–∫-—Å–µ–∫—Ü–∏—è 2": {
                num: ["1", "2", "3", "4", "5"],
                let: ["–ï", "–ò", "–ò/1", "–ö", "–õ", "–ú", "–ú/2", "–ù", "–ü", "–†"]
            },
            "–ë–ª–æ–∫-—Å–µ–∫—Ü–∏—è 3": {
                num: ["6", "7", "8", "9", "9/1", "10", "10/1", "11", "11/1", "12", "13", "14", "14/1", "15"],
                let: ["–ö", "–õ", "–ú", "–ù", "–ü", "–ü/1", "–†", "–°", "–¢", "–£"]
            },
            "–ë–ª–æ–∫-—Å–µ–∫—Ü–∏—è 4": {
                num: ["6", "7", "8", "9", "9/1", "10", "10/1", "11", "11/1", "12", "13", "14", "14/1", "15"],
                let: ["–ï", "–ï/1", "–ñ", "–ò", "–ö/1"]
            },
            "–ë–ª–æ–∫-—Å–µ–∫—Ü–∏—è 5": {
                num: ["11", "11/1", "12", "13", "14", "14/1", "15", "16", "16/1", "17", "18", "19"],
                let: ["–£", "–£/1", "–§", "–®", "–≠", "–Æ", "–Ø", "–ê–ê", "–í–í", "–ì–ì", "–î–î", "–ê/1"]
            },
            "–ë–ª–æ–∫-—Å–µ–∫—Ü–∏—è 6": {
                num: ["16", "17", "18", "19", "20", "21", "22"],
                let: ["–ò", "–ö/1", "–ö", "–õ", "–ú", "–ù", "–ü", "–ü/1", "–†", "–°", "–¢"]
            },
            "–ë–ª–æ–∫-—Å–µ–∫—Ü–∏—è 7": {
                num: ["16", "16/1", "17", "18", "19", "20", "21", "22"],
                let: ["–ê", "–ë", "–í", "–í/1", "–ì", "–î", "–î/1", "–ï", "–ï/1", "–ñ"]
            },
            "–ò–Ω—Ç–µ—Ä–Ω–∞—Ç": {
                num: ["1", "2", "3", "4"],
                let: ["–ê", "–ë", "–í", "–ì", "–î", "–ï", "–ñ", "–ò", "–ö", "–õ", "–ú", "–ù", "–ü", "–†", "–°", "–¢", "–£"]
            },
            "–¢—ë–ø–ª–∞—è —Å—Ç–æ—è–Ω–∫–∞": {
                num: ["1", "2"],
                let: ["–ê", "–ë", "–í"]
            }
        };

        // –ë–∞–∑–∞ –ø–æ–¥—Ä—è–¥—á–∏–∫–æ–≤
        const CONTRACTORS = {
            "–ü–†–û–ù–¢–û": "–û–û–û ¬´–ü–†–û–ù–¢–û¬ª, 123112, –≥. –ú–æ—Å–∫–≤–∞, –Ω–∞–±. –ü—Ä–µ—Å–Ω–µ–Ω—Å–∫–∞—è, –¥. 12 –ø–æ–º. 14/64. –î–æ–≥–æ–≤–æ—Ä —Å—É–±–ø–æ–¥—Ä—è–¥–∞ ‚Ññ5930/01 –æ—Ç 13.01.2026 –≥.",
            "–°—Ç—Ä–æ–π–ú–æ–Ω–æ–ª–∏—Ç": "–û–û–û ¬´–°—Ç—Ä–æ–π–ú–æ–Ω–æ–ª–∏—Ç¬ª, 656066, –≥. –ë–∞—Ä–Ω–∞—É–ª, —É–ª. –û—Å—Ç—Ä–æ–≤—Å–∫–æ–≥–æ, –¥. 49, –ø–æ–º. –ù1. –î–æ–≥–æ–≤–æ—Ä –ø–æ–¥—Ä—è–¥–∞ ‚Ññ5732/07 –æ—Ç 07.07.2025 –≥.",
            "–°—Ç—Ä–æ–π –¢—Ä–µ–π–¥": "–û–û–û ¬´–°—Ç—Ä–æ–π –¢—Ä–µ–π–¥¬ª, 649100, –†–ê, –ú–∞–π–º–∏–Ω—Å–∫–∏–π —Ä-–Ω, —Å. –ú–∞–π–º–∞, —É–ª. –¢—Ä—É–¥–æ–≤–∞—è, –¥.34, –∫–≤. 2. –î–æ–≥–æ–≤–æ—Ä —Å—É–±–ø–æ–¥—Ä—è–¥–∞ ‚Ññ5720/07 –æ—Ç 01.07.2025 –≥."
        };

        function updateAxes() {
            const buildName = document.getElementById('building').value;
            const data = AXES_DB[buildName];
            
            fillSelect('axis_num_start', data?.num || []);
            fillSelect('axis_num_end', data?.num || []);
            fillSelect('axis_let_start', data?.let || []);
            fillSelect('axis_let_end', data?.let || []);
        }

        function fillSelect(id, values) {
            const sel = document.getElementById(id);
            sel.innerHTML = '<option value="">-</option>';
            values.forEach(v => {
                const opt = document.createElement('option');
                opt.value = v;
                opt.innerText = v;
                sel.appendChild(opt);
            });
        }

        function checkContractor() {
            const val = document.getElementById('contractor').value;
            const manual = document.getElementById('contractor_manual');
            if (val === 'other') {
                manual.style.display = 'block';
            } else {
                manual.style.display = 'none';
            }
        }

        // –§–æ—Ç–æ
        document.getElementById('photo-input').addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.getElementById('photo-preview');
                    img.src = e.target.result;
                    img.style.display = 'block';
                }
                reader.readAsDataURL(file);
            }
        });

        function nextStep() {
            if (!document.getElementById('building').value) {
                tg.showPopup({message: '–í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç!'});
                return;
            }
            document.getElementById('step1').classList.add('hidden');
            document.getElementById('step2').classList.remove('hidden');
        }

        function prevStep() {
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step1').classList.remove('hidden');
        }

        function sendData() {
            // –°–æ–±–∏—Ä–∞–µ–º –æ—Å–∏
            let axes = '';
            const n1 = document.getElementById('axis_num_start').value;
            const n2 = document.getElementById('axis_num_end').value;
            const l1 = document.getElementById('axis_let_start').value;
            const l2 = document.getElementById('axis_let_end').value;

            if (n1) axes += n1;
            if (n2 && n2 !== n1) axes += '-' + n2;
            if (l1) axes += (axes ? ' / ' : '') + l1;
            if (l2 && l2 !== l1) axes += '-' + l2;

            // –ü–æ–¥—Ä—è–¥—á–∏–∫
            const cVal = document.getElementById('contractor').value;
            const contractorData = cVal === 'other' 
                ? document.getElementById('contractor_manual').value 
                : CONTRACTORS[cVal];

            const data = {
                action: "create_prescription",
                building: document.getElementById('building').value,
                floor: document.getElementById('floor').value,
                axes: axes || "–ù–µ —É–∫–∞–∑–∞–Ω—ã",
                structure: document.getElementById('structure').value,
                issue: document.getElementById('issue').value || "–ó–∞–º–µ—á–∞–Ω–∏–µ –Ω–µ –æ–ø–∏—Å–∞–Ω–æ",
                contractor_info: contractorData || "–ü–æ–¥—Ä—è–¥—á–∏–∫ –Ω–µ –≤—ã–±—Ä–∞–Ω"
            };

            tg.sendData(JSON.stringify(data));
        }
    </script>
</body>
</html>
